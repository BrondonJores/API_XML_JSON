version: '3.8'

services:
  mysql-menu:
    image: mysql:8.0
    container_name: mysql-menu
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: canteen_menu
    ports:
      - "3306:3306"
    volumes:
      - mysql-menu-data:/var/lib/mysql
    networks:
      - canteen-network

  mysql-orders:
    image: mysql:8.0
    container_name: mysql-orders
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: canteen_orders
    ports:
      - "3307:3306"
    volumes:
      - mysql-orders-data:/var/lib/mysql
    networks:
      - canteen-network

  mysql-auth:
    image: mysql:8.0
    container_name: mysql-auth
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: canteen_auth
    ports:
      - "3308:3306"
    volumes:
      - mysql-auth-data:/var/lib/mysql
    networks:
      - canteen-network

  service-menu:
    build: ./service-menu-java
    container_name: service-menu
    ports:
      - "8001:8080"
    environment:
      DB_HOST: mysql-menu
      DB_PORT: 3306
      DB_NAME: canteen_menu
      DB_USER: root
      DB_PASSWORD: root123
    depends_on:
      - mysql-menu
    networks:
      - canteen-network

  service-orders:
    build: ./service-orders-python
    container_name: service-orders
    ports:
      - "8002:5000"
    environment:
      DB_HOST: mysql-orders
      DB_PORT: 3306
      DB_NAME: canteen_orders
      DB_USER: root
      DB_PASSWORD: root123
      MENU_SERVICE_URL: http://service-menu:8080
    depends_on:
      - mysql-orders
    networks:
      - canteen-network

  service-gateway:
    build: ./service-gateway-laravel
    container_name: service-gateway
    ports:
      - "8003:8000"
    environment:
      DB_HOST: mysql-auth
      DB_PORT: 3306
      DB_NAME: canteen_auth
      DB_USER: root
      DB_PASSWORD: root123
      MENU_SERVICE_URL: http://service-menu:8080
      ORDERS_SERVICE_URL: http://service-orders:5000
    depends_on:
      - mysql-auth
    networks:
      - canteen-network

  service-frontend:
    build: ./service-frontend-react
    container_name: service-frontend
    ports:
      - "3000:80"
    environment:
      VITE_API_URL: http://localhost:8003
    depends_on:
      - service-gateway
    networks:
      - canteen-network

volumes:
  mysql-menu-data:
  mysql-orders-data:
  mysql-auth-data:

networks:
  canteen-network:
    driver: bridge
